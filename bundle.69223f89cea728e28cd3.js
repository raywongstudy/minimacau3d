(()=>{function e(e,t,n){const o=document.getElementById("current-time");o.style.transition="opacity 0.3s ease-in-out",o.style.opacity="0.5",setTimeout((()=>{o.innerHTML=`${e}:${t}:${n}`,o.style.opacity="1"}),200)}window.usingApiTime=!1,window.startClock=function(){if(window.usingApiTime)return void setTimeout(startClock,500);const n=new Date;e(t(n.getHours(),2),t(n.getMinutes(),2),t(n.getSeconds(),2)),setTimeout(startClock,500)},window.updateBusDateTime=function(o){if(!o)return;window.usingApiTime=!0,document.getElementById("current-date").innerText=n(o);if(e(t(o.getHours(),2),t(o.getMinutes(),2),t(o.getSeconds(),2)),!document.getElementById("api-time-indicator")){const e=document.getElementById("current-time-box"),t=document.createElement("div");t.id="api-time-indicator",t.style.fontSize="12px",t.style.color="#ffcc00",t.style.opacity="1",t.style.textAlign="center",t.innerText="API數據時間",e.appendChild(t)}};const t=(e,t)=>{let n=e;return"string"!=typeof e&&(n=e.toString()),n.padStart(t,"0")};function n(e){if(0!=e)e=new Date(e);else e=new Date;var t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),c=e.getDay();switch(c){case 1:c="週一";break;case 2:c="週二";break;case 3:c="週三";break;case 4:c="週四";break;case 5:c="週五";break;case 6:c="週六";break;case 0:c="週日"}return t+"年"+n+"月"+o+"日 "+c}document.getElementById("current-date").innerText=n(0),document.addEventListener("DOMContentLoaded",(function(){Object.keys({"toggle-station-button":!1,"toggle-route-button":!1,"demo-data-button":!1}).forEach((e=>{const t=document.getElementById(e);t&&(t.style.display="none")}));const e=document.querySelector(".mapboxgl-ctrl-geocoder.mapboxgl-ctrl");e&&e.addEventListener("click",(function(t){e.classList.add("mapboxgl-ctrl-geocoder-search-box")}));const t=document.getElementById("search-modal"),n=document.getElementById("search-route-button"),o=document.getElementById("search-confirm"),c=document.getElementById("search-cancel"),i=document.getElementById("route-select"),l=document.getElementById("direction-select");n.addEventListener("click",(function(){t.style.display="block",i.children.length<=1&&[...new Set(traffic_data.map((e=>e.routeCode)))].sort().forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.replace(/^0+/,""),i.appendChild(t)}))})),i.addEventListener("change",(function(){if(l.innerHTML='<option value="">請選擇方向...</option>',this.value){const e=this.value;traffic_data.filter((t=>t.routeCode===e)).map((e=>e.direction)).filter(((e,t,n)=>n.indexOf(e)===t)).forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,l.appendChild(t)})),l.disabled=!1}else l.disabled=!0})),o.addEventListener("click",(function(){const e=i.value,n=l.value;if(e&&n){window.trafficIds.forEach((e=>{window.map.setPaintProperty(e,"line-opacity",0)}));window.trafficIds.filter((t=>t.includes(e)&&t.includes(n))).forEach((e=>{window.map.setPaintProperty(e,"line-opacity",1)}))}t.style.display="none"})),c.addEventListener("click",(function(){t.style.display="none",window.trafficIds.forEach((e=>{window.map.setPaintProperty(e,"line-opacity",.4)}))})),t.addEventListener("click",(function(e){e.target===t&&(t.style.display="none",window.trafficIds.forEach((e=>{window.map.setPaintProperty(e,"line-opacity",.4)})))}))})),window.showMapButton=function(e){const t=document.getElementById(e);t&&(t.style.display="flex")},window.hideMapButton=function(e){const t=document.getElementById(e);t&&(t.style.display="none")};var o=!0,c=document.getElementById("toggle-station-button");c.addEventListener("click",(function(){window.map&&(o=!o,window.map.setLayoutProperty("bus_station","visibility",o?"visible":"none"),c.style.backgroundColor=o?"":"gray")}));var i=!0,l=document.getElementById("toggle-route-button");l.addEventListener("click",(function(){window.map&&window.trafficIds&&(i=!i,window.trafficIds.forEach((e=>{window.map.setLayoutProperty(e,"visibility",i?"visible":"none")})),l.style.backgroundColor=i?"":"gray")}));var d=document.getElementById("fullscreen-button"),s=!1;function a(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?(d.querySelector("i").classList.remove("fa-expand"),d.querySelector("i").classList.add("fa-compress"),s=!0):(d.querySelector("i").classList.remove("fa-compress"),d.querySelector("i").classList.add("fa-expand"),s=!1)}d.addEventListener("click",(function(){s?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),d.querySelector("i").classList.remove("fa-compress"),d.querySelector("i").classList.add("fa-expand")):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),d.querySelector("i").classList.remove("fa-expand"),d.querySelector("i").classList.add("fa-compress")),s=!s})),document.addEventListener("fullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),document.addEventListener("mozfullscreenchange",a),document.addEventListener("MSFullscreenChange",a)})();