(()=>{window.usingApiTime=!1,window.startClock=function(){if(window.usingApiTime)return void setTimeout(startClock,500);const t=new Date,n=e(t.getHours(),2),o=e(t.getMinutes(),2),c=e(t.getSeconds(),2);document.getElementById("current-time").innerHTML=`${n}:${o}:${c}`,setTimeout(startClock,500)},window.updateBusDateTime=function(n){if(!n)return;window.usingApiTime=!0,document.getElementById("current-date").innerText=t(n);const o=e(n.getHours(),2),c=e(n.getMinutes(),2),i=e(n.getSeconds(),2);if(document.getElementById("current-time").innerHTML=`${o}:${c}:${i}`,!document.getElementById("api-time-indicator")){const e=document.getElementById("current-time-box"),t=document.createElement("div");t.id="api-time-indicator",t.style.fontSize="12px",t.style.color="#ffcc00",t.style.opacity="1",t.style.textAlign="center",t.innerText="API數據時間",e.appendChild(t)}};const e=(e,t)=>{let n=e;return"string"!=typeof e&&(n=e.toString()),n.padStart(t,"0")};function t(e){if(0!=e)e=new Date(e);else e=new Date;var t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),c=e.getDay();switch(c){case 1:c="週一";break;case 2:c="週二";break;case 3:c="週三";break;case 4:c="週四";break;case 5:c="週五";break;case 6:c="週六";break;case 0:c="週日"}return t+"年"+n+"月"+o+"日 "+c}document.getElementById("current-date").innerText=t(0),document.addEventListener("DOMContentLoaded",(function(){Object.keys({"toggle-station-button":!1,"toggle-route-button":!1,"demo-data-button":!1}).forEach((e=>{const t=document.getElementById(e);t&&(t.style.display="none")}));const e=document.querySelector(".mapboxgl-ctrl-geocoder.mapboxgl-ctrl");e&&e.addEventListener("click",(function(t){e.classList.add("mapboxgl-ctrl-geocoder-search-box")}));const t=document.getElementById("search-modal"),n=document.getElementById("search-route-button"),o=document.getElementById("search-confirm"),c=document.getElementById("search-cancel"),i=document.getElementById("route-select"),d=document.getElementById("direction-select");n.addEventListener("click",(function(){t.style.display="block",i.children.length<=1&&[...new Set(traffic_data.map((e=>e.routeCode)))].sort().forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e.replace(/^0+/,""),i.appendChild(t)}))})),i.addEventListener("change",(function(){if(d.innerHTML='<option value="">請選擇方向...</option>',this.value){const e=this.value;traffic_data.filter((t=>t.routeCode===e)).map((e=>e.direction)).filter(((e,t,n)=>n.indexOf(e)===t)).forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,d.appendChild(t)})),d.disabled=!1}else d.disabled=!0})),o.addEventListener("click",(function(){const e=i.value,n=d.value;if(e&&n){window.trafficIds.forEach((e=>{window.map.setPaintProperty(e,"line-opacity",0)}));window.trafficIds.filter((t=>t.includes(e)&&t.includes(n))).forEach((e=>{window.map.setPaintProperty(e,"line-opacity",1)}))}t.style.display="none"})),c.addEventListener("click",(function(){t.style.display="none",window.trafficIds.forEach((e=>{window.map.setPaintProperty(e,"line-opacity",.4)}))})),t.addEventListener("click",(function(e){e.target===t&&(t.style.display="none",window.trafficIds.forEach((e=>{window.map.setPaintProperty(e,"line-opacity",.4)})))}))})),window.showMapButton=function(e){const t=document.getElementById(e);t&&(t.style.display="flex")},window.hideMapButton=function(e){const t=document.getElementById(e);t&&(t.style.display="none")};var n=!0,o=document.getElementById("toggle-station-button");o.addEventListener("click",(function(){window.map&&(n=!n,window.map.setLayoutProperty("bus_station","visibility",n?"visible":"none"),o.style.backgroundColor=n?"":"gray")}));var c=!0,i=document.getElementById("toggle-route-button");i.addEventListener("click",(function(){window.map&&window.trafficIds&&(c=!c,window.trafficIds.forEach((e=>{window.map.setLayoutProperty(e,"visibility",c?"visible":"none")})),i.style.backgroundColor=c?"":"gray")}));var d=document.getElementById("fullscreen-button"),l=!1;function r(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?(d.querySelector("i").classList.remove("fa-expand"),d.querySelector("i").classList.add("fa-compress"),l=!0):(d.querySelector("i").classList.remove("fa-compress"),d.querySelector("i").classList.add("fa-expand"),l=!1)}d.addEventListener("click",(function(){l?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),d.querySelector("i").classList.remove("fa-compress"),d.querySelector("i").classList.add("fa-expand")):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),d.querySelector("i").classList.remove("fa-expand"),d.querySelector("i").classList.add("fa-compress")),l=!l})),document.addEventListener("fullscreenchange",r),document.addEventListener("webkitfullscreenchange",r),document.addEventListener("mozfullscreenchange",r),document.addEventListener("MSFullscreenChange",r)})();