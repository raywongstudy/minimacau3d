import{filterCurrentBusData}from"./BusDataUtils.js";export async function handleBusPositionUpdates(e,t){const s=e.id.split("_"),a=s[s.length-1],u=s[s.length-2],n=filterCurrentBusData(t,u,a);await updateLayerCubes(e,n)}async function updateLayerCubes(e,t){if(!isValidBusData(t))return;const s=prepareCubesForUpdate(e);await updateBusesInLayer(e,t,s)}function isValidBusData(e){return!(!e||0===e.length)}function prepareCubesForUpdate(e){const t=e.cube_list.slice();return{allCubes:t,remainingCubes:t.slice()}}async function updateBusesInLayer(e,t,s){for(const a of t)isValidBusInfo(a)&&await updateBusGroup(e,a,s);removeInactiveBuses(e,s.remainingCubes)}function isValidBusInfo(e){return!(!e||!e.busInfoList)}function removeInactiveBuses(e,t){if(t.length>0)for(const s of t)e.scene.remove(s),e.cube_list=e.cube_list.filter((e=>e.userData.busPlate!==s.userData.busPlate))}